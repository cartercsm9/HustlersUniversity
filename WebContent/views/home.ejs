<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Weather Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Check if the user's agreement is stored in localStorage
            let userAgreed = localStorage.getItem('userAgreed');

            // If not, ask for permission and store the response
            if (userAgreed === null) {
                userAgreed = window.confirm("We need your location to provide local weather information. Do you allow us to access your location?");
                localStorage.setItem('userAgreed', userAgreed);
            }

            requestUserLocation(userAgreed);
        });
    </script>
</head>
<body>
    <header>
        <header>
            <div class="header-container">
                <nav>
                    <% if (username) { %>
                        <a href="/logout" class="login-link">Logout</a>
                    <% } else { %>
                        <a href="/login" class="login-link">Login</a>
                    <% } %>
                </nav>
                <% if (username) { %>
                    <p class="welcome-message">Welcome <%= username %></p>
                    <a href="/users/admin" class="login-link">Admin</a>
                <% } %>
            </div>
        </header>
    </header>
    <main class="dashboard">
        <div>
            <button id="sendButton">Send Email Notification</button>
        </div>

        <div class="info-panels">
            <div class="panel" id="weatherPanel">
                <h3>Current Weather</h3>
                <div id="cityName"></div>
                <div id="temperature"></div>
                <div id="condition"></div>
                <img id="weatherIcon" src="" alt="Weather Icon" style="display:none;">
            </div>   
            <div class="panel">
                <h3>Forecast</h3>
                <div id="weatherForecast"></div>
            </div>
            <div class="panel">
                <h3>Weather Search</h3>
                <input type="text" id="cityinput" placeholder="Enter City Name">
                <button onclick="submitCityName('cityinput','weatherDisplay')">Get Weather</button>
                <div id="weatherDisplay"></div>
            </div>
            <!-- Row 2 -->
            <div class="panel">
                <a href="/forecast" class="panel-link">Forecast Search</a>
            </div>
            <div class="panel">
                <a href="/historyPage" class="panel-link">Historical Data</a>
            </div>
            <div class="panel">
                <a href="/map" class="panel-link">Map</a>
            </div>
            <div class="panel">
                <a href="/userPref" class="panel-link">User Preference</a>
            </div>
            <div class="panel">
                <a href="/aboutUs" class="panel-link">About Us</a>
            </div>
            <div class="panel">
                <a href="/contactUs" class="panel-link">Contact Us</a>
            </div>
        </div>
    </main>
    <script src="/noti-helper.js"></script>
    <script src="/weathertest.js"></script>
    <script src="/getCurrentLocation.js"></script>
</body>  
</html>
