<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Tracker History</title>
    <link rel="stylesheet" href="css/historyPage.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
</head>
<body>
    <header>
        <h1>Weather Tracker History</h1>
    </header>
    <main>
        <div class="filter-buttons">
            <label for="locations">Choose A Location:</label>
            <select name="country" id="country">
                <% const uniqueCountries = [...new Set(locations.map(loc => loc.country))]; %>
                <% uniqueCountries.forEach(country => { %>
                    <option value="<%= country %>"><%= country %></option>
                <% }); %>
            </select>
            <select name="locations" id="locations">
                <% locations.forEach(location => { %>
                    <option value="<%= location.city %>" data-country="<%= location.country %>"><%= location.city %></option>
                <% }); %>
            </select>
        </div>
        
        <div class="graphs-container">
            <div class="graph-box" id="graph-box-1"></div>
            <div class="graph-box" id="graph-box-2"></div>
            <div class="graph-box" id="graph-box-3"></div>
        </div>
    </main>

    <script>
        $(document).ready(function() {
            $('#country').select2();
    
            var originalLocations = $('#locations option').map(function() {
                return { city: $(this).val(), country: $(this).data('country') };
            }).get();
    
            $('#country').on('change', function() {
                var selectedCountry = $(this).val();
    
                var filteredLocations = originalLocations.filter(function(location) {
                    return location.country === selectedCountry;
                });
    
                var $locationsSelect = $('#locations').empty();
                $.each(filteredLocations, function(index, location) {
                    $locationsSelect.append(new Option(location.city, location.city));
                });
    
                $locationsSelect.select2();
            });
    
            $('#locations').select2();
        });
    </script>
     
</body>
</html>